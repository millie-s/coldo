<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coldo</title>
</head>
<body>
    <h1>Coldo</h1>
    <p>次のメッセージに対応しています。</p>
    <p>活動をやめたら/いつも応援しています/ぶりっこきつ/今日のテレビでの笑顔ぎこちなかったよ？/引退したらいいと思う</p>
    <p>返答は音声でされます</p>
    <button id="startButton">音声入力開始</button>
    <button id="stopButton">音声入力停止</button>
    <p id="recognizedText">認識されたテキスト: </p>
    <p id="receivedText">アイドルが受け取ったテキスト</p>

    <script>
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const recognizedTextElement = document.getElementById('recognizedText');
        const receivedTextElement = document.getElementById('receivedText');
        const replyTextElement = document.getElementById('replyText');

        let recognition;
        if (!('webkitSpeechRecognition' in window)) {
            alert('このブラウザは音声認識APIをサポートしていません。');
        } else {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                recognizedTextElement.textContent = '認識されたテキスト: ' + finalTranscript + interimTranscript;
                if (finalTranscript) {
                    const rmessage = recievedmessage(finalTranscript.trim());
                    const response = generateReply(finalTranscript.trim());
                    receivedTextElement.textContent ='アイドルが受け取ったメッセージ: '+rmessage;
                    speak(response);
                }
            };
        }

        startButton.addEventListener('click', () => {
            recognition.start();
        });

        stopButton.addEventListener('click', () => {
            recognition.stop();
        });
        function recievedmessage(message) {
            const replies = {
                "活動をやめたら": "君のユニークな個性は他の場所でもっと輝くと思うから、別の活動にチャレンジしてみたらどうかな？",
                "いつも応援しています": "いつも応援してます。",
                "ぶりっこきつ":"もっと自然体の君が見たいな！",
                "今日のテレビでの笑顔ぎこちなかったよ？":"今日のテレビの笑顔も良いけど昨日の方が好きだったな",
                "引退したらいいと思う":"新しいチャレンジを探してみたらどうかな？"
            };
            return replies[message] || "対応不可のメッセージが送られました。もう一度送ってもらうようにしてください";
        }

        function generateReply(message) {
            const replies = {
                "活動をやめたら": "いつも応援してくれてありがとう違うところでの活躍も応援してね",
                "いつも応援しています": "応援ありがとう!とっても嬉しい",
                "ぶりっこきつ":"君にいつでもかわいくみられるように頑張るね",
                "今日のテレビでの笑顔ぎこちなかったよ？":"いつもよく見ててくれてありがとう！",
                "引退したらいいと思う":"ほかの分野での活躍もできるように頑張るね!"
            };
            return replies[message] || "すみません、聞き取れませんでした。もう一度言ってください";
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
